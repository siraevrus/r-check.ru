# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –Ω–∞ production —Å–µ—Ä–≤–µ—Ä

## –°–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ –ø—Ä–æ–¥–∞–∂ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥–∞–º

### üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É

- **PHP**: 7.4 –∏–ª–∏ –≤—ã—à–µ
- **SQLite**: 3.x
- **–í–µ–±-—Å–µ—Ä–≤–µ—Ä**: Apache/Nginx
- **–†–∞—Å—à–∏—Ä–µ–Ω–∏—è PHP**:
  - pdo_sqlite
  - mbstring
  - zip
  - xml

### üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

#### 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤

–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤—Å–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ FTP/SFTP.

```bash
# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
/var/www/html/reprocrm/
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ reprocrm.db
‚îÇ   ‚îî‚îÄ‚îÄ schema.sqlite.sql
‚îú‚îÄ‚îÄ src/
‚îú‚îÄ‚îÄ vendor/
‚îú‚îÄ‚îÄ uploads/
‚îú‚îÄ‚îÄ logs/
‚îú‚îÄ‚îÄ *.php
‚îî‚îÄ‚îÄ composer.json
```

#### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd /var/www/html/reprocrm
php composer.phar install --no-dev --optimize-autoloader
```

–ò–ª–∏ –µ—Å–ª–∏ composer —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≥–ª–æ–±–∞–ª—å–Ω–æ:

```bash
composer install --no-dev --optimize-autoloader
```

#### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

```bash
# –ü—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
chmod 755 database/
chmod 755 uploads/
chmod 755 logs/

# –ü—Ä–∞–≤–∞ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
chmod 664 database/reprocrm.db

# –ü—Ä–∞–≤–∞ –Ω–∞ –ø–∞–ø–∫–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏
chmod 775 uploads/
chmod 775 logs/
```

#### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞

**Apache (.htaccess):**

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.htaccess` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```apache
RewriteEngine On

# –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ HTTPS (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# –°–∫—Ä—ã—Ç—å —Å–ª—É–∂–µ–±–Ω—ã–µ —Ñ–∞–π–ª—ã
<FilesMatch "\.(md|json|lock|env|sql|log)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# –ó–∞—â–∏—Ç–∞ –ø–∞–ø–∫–∏ vendor
<Directory vendor>
    Order allow,deny
    Deny from all
</Directory>

# –ó–∞—â–∏—Ç–∞ –ø–∞–ø–∫–∏ database
<Directory database>
    Order allow,deny
    Deny from all
</Directory>

# –ó–∞—â–∏—Ç–∞ –ø–∞–ø–∫–∏ logs
<Directory logs>
    Order allow,deny
    Deny from all
</Directory>
```

**Nginx:**

```nginx
server {
    listen 80;
    server_name your-domain.com;
    root /var/www/html/reprocrm;
    index index.php;

    # –°–∫—Ä—ã—Ç—å —Å–ª—É–∂–µ–±–Ω—ã–µ —Ñ–∞–π–ª—ã
    location ~ \.(md|json|lock|env|sql|log)$ {
        deny all;
    }

    # –ó–∞—â–∏—Ç–∞ –ø–∞–ø–æ–∫
    location ~ ^/(vendor|database|logs)/ {
        deny all;
    }

    # PHP –æ–±—Ä–∞–±–æ—Ç–∫–∞
    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }
}
```

#### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `config.env` –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ:

```bash
cp config.env.example config.env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `config.env`:

```env
APP_NAME="–°–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ –ø—Ä–æ–¥–∞–∂"
DB_TYPE=sqlite
DB_PATH=database/reprocrm.db
JWT_SECRET=your_secure_random_string_here
```

#### 6. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ï—Å–ª–∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—É—Å—Ç–∞—è –∏–ª–∏ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞:

```bash
sqlite3 database/reprocrm.db < database/schema.sqlite.sql
```

#### 7. –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:

```sql
INSERT INTO admins (email, password_hash, created_at, updated_at)
VALUES (
    'admin@yourdomain.com',
    '$2y$10$YourPasswordHashHere',
    datetime('now'),
    datetime('now')
);
```

–î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–∞—Ä–æ–ª—è:

```php
<?php
echo password_hash('your_secure_password', PASSWORD_DEFAULT);
?>
```

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ò–∑–º–µ–Ω–∏—Ç–µ JWT_SECRET** –≤ `config.env` –Ω–∞ —Å–ª—É—á–∞–π–Ω—É—é —Å—Ç—Ä–æ–∫—É
2. **–°–æ–∑–¥–∞–π—Ç–µ —Å–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å** –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ HTTPS** –Ω–∞ production
4. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø** –∫ —Å–ª—É–∂–µ–±–Ω—ã–º —Ñ–∞–π–ª–∞–º
5. **–†–µ–≥—É–ª—è—Ä–Ω–æ –¥–µ–ª–∞–π—Ç–µ backup** –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ—Å—Ç—É–ø–æ–≤

#### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä

- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å –ø—Ä–æ–¥–∞–∂–∞–º–∏
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–æ–≤ –≤—Ä–∞—á–µ–π
- ‚úÖ –í—ã–¥–∞—á–∞ –ø—Ä–∏–∑–æ–≤
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏

#### –í—Ä–∞—á (–º–µ–¥—Ä–∞–±–æ—Ç–Ω–∏–∫)

- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö –ø—Ä–æ–¥–∞–∂
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –≤—ã–¥–∞—á–∏ –ø—Ä–∏–∑–æ–≤

### üîÑ Workflow

1. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–º–æ–∫–æ–¥—ã** (–º–∞—Å—Å–æ–≤–æ)
2. **–ó–∞–≥—Ä—É–∂–∞–µ—Ç CSV —Ñ–∞–π–ª—ã** —Å –ø—Ä–æ–¥–∞–∂–∞–º–∏
3. **–í—Ä–∞—á–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è** –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥–∞–º
4. **–í—Ä–∞—á–∏ –≤–∏–¥—è—Ç** —Å–≤–æ—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
5. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤—ã–¥–∞–µ—Ç –ø—Ä–∏–∑—ã** –≤—Ä–∞—á–∞–º

### üìÅ –§–æ—Ä–º–∞—Ç CSV —Ñ–∞–π–ª–∞

```csv
–ü—Ä–æ–º–æ–∫–æ–¥,–ü—Ä–æ–¥—É–∫—Ç,–î–∞—Ç–∞,–ü—Ä–æ–¥–∞–∂–∏
TEST0001,–ü—Ä–æ–¥—É–∫—Ç –ê,2025-10-08,5
TEST0002,–ü—Ä–æ–¥—É–∫—Ç –ë,2025-10-08,3
```

**–ö–æ–ª–æ–Ω–∫–∏:**
- **–ü—Ä–æ–º–æ–∫–æ–¥** (8 —Å–∏–º–≤–æ–ª–æ–≤) - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
- **–ü—Ä–æ–¥—É–∫—Ç** - –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
- **–î–∞—Ç–∞** - –¥–∞—Ç–∞ –ø—Ä–æ–¥–∞–∂–∏ (YYYY-MM-DD) - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ–≥–æ–¥–Ω—è
- **–ü—Ä–æ–¥–∞–∂–∏** (–∏–ª–∏ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–∞–∂ (—Å—É–º–º–∏—Ä—É–µ—Ç—Å—è)

### üõ†Ô∏è –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

#### Backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ (–∫–æ–ø–∏—è .db):**
```bash
cp database/reprocrm.db backups/reprocrm_$(date +%Y%m%d_%H%M%S).db
```

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø –≤ ZIP –ø–æ cron** ‚Äî —Å–º. [CRON_BACKUP.md](CRON_BACKUP.md). –°–∫—Ä–∏–ø—Ç `scripts/backup_db_zip.php` —Å–æ–∑–¥–∞—ë—Ç –∞—Ä—Ö–∏–≤ –≤ `backups/`.

**–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ .db:**
```bash
cp backups/reprocrm_20251008_120000.db database/reprocrm.db
```

#### –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤

```bash
# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤ (—Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π)
find logs/ -name "*.log" -mtime +30 -delete
```

#### –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

```bash
# –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
find uploads/ -type f -mtime +7 -delete
```

### üìù –í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã

- `database/reprocrm.db` - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite
- `config.env` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `logs/file_upload.log` - –ª–æ–≥–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
- `uploads/` - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### üîó –û—Å–Ω–æ–≤–Ω—ã–µ URL

- `/` - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- `/admin.php` - –≤—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- `/doctor.php` - –≤—Ö–æ–¥ –≤—Ä–∞—á–∞
- `/doctor_register.php` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Ä–∞—á–∞
- `/promo_codes.php` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏ (–∞–¥–º–∏–Ω)
- `/file_upload.php` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ (–∞–¥–º–∏–Ω)
- `/users_report.php` - –æ—Ç—á–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∞–¥–º–∏–Ω)

### ‚ö° Production –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

–í `php.ini`:

```ini
upload_max_filesize = 10M
post_max_size = 10M
max_execution_time = 300
memory_limit = 256M
```

### üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –õ–æ–≥–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
2. –õ–æ–≥–∏ PHP (error_log)
3. –§–∞–π–ª `logs/file_upload.log`
4. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º –∏ –ø–∞–ø–∫–∞–º

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** –û–∫—Ç—è–±—Ä—å 2025





